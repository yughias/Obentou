#include "cores/gbc/bootrom_skip.h"
#include "cores/gbc/gb.h"
#include "cores/gbc/info.h"
#include "string.h"

typedef struct {
    u8 hash;
    char forth_char;
    int bg[4];
    int obj0[4];
    int obj1[4];
} paletteConfig;

static paletteConfig paletteConfigs[] = {
    {0x00, 0, {0xFFFFFF, 0x7BFF31, 0x0063C5, 0x000000}, {0xFFFFFF, 0xFF8484, 0x943A3A, 0x000000}, {0xFFFFFF, 0xFF8484, 0x943A3A, 0x000000}},
    {0xB3, 'U', {0xFFFFFF, 0xADAD84, 0x42737B, 0x000000}, {0xFFFFFF, 0xFF7300, 0x944200, 0x000000}, {0xFFFFFF, 0xFF7300, 0x944200, 0x000000}},
    {0x59, 0, {0xFFFFFF, 0xADAD84, 0x42737B, 0x000000}, {0xFFFFFF, 0xFF7300, 0x944200, 0x000000}, {0xFFFFFF, 0x5ABDFF, 0xFF0000, 0x0000FF}},
    {0xC6, 'A', {0xFFFFFF, 0xADAD84, 0x42737B, 0x000000}, {0xFFFFFF, 0xFF7300, 0x944200, 0x000000}, {0xFFFFFF, 0x5ABDFF, 0xFF0000, 0x0000FF}},
    {0x8C, 0, {0xFFFF9C, 0x94B5FF, 0x639473, 0x003A3A}, {0xFFFF9C, 0x94B5FF, 0x639473, 0x003A3A}, {0xFFFF9C, 0x94B5FF, 0x639473, 0x003A3A}},
    {0x86, 0, {0xFFFF9C, 0x94B5FF, 0x639473, 0x003A3A}, {0xFFC542, 0xFFD600, 0x943A00, 0x4A0000}, {0xFFFFFF, 0xFF8484, 0x943A3A, 0x000000}},
    {0xA8, 0, {0xFFFF9C, 0x94B5FF, 0x639473, 0x003A3A}, {0xFFC542, 0xFFD600, 0x943A00, 0x4A0000}, {0xFFFFFF, 0xFF8484, 0x943A3A, 0x000000}},
    {0xBF, 'C', {0x6BFF00, 0xFFFFFF, 0xFF524A, 0x000000}, {0xFFFFFF, 0xFFFFFF, 0x63A5FF, 0x0000FF}, {0xFFFFFF, 0xFFAD63, 0x843100, 0x000000}},
    {0xCE, 0, {0x6BFF00, 0xFFFFFF, 0xFF524A, 0x000000}, {0xFFFFFF, 0xFFFFFF, 0x63A5FF, 0x0000FF}, {0xFFFFFF, 0xFFAD63, 0x843100, 0x000000}},
    {0xD1, 0, {0x6BFF00, 0xFFFFFF, 0xFF524A, 0x000000}, {0xFFFFFF, 0xFFFFFF, 0x63A5FF, 0x0000FF}, {0xFFFFFF, 0xFFAD63, 0x843100, 0x000000}},
    {0xF0, 0, {0x6BFF00, 0xFFFFFF, 0xFF524A, 0x000000}, {0xFFFFFF, 0xFFFFFF, 0x63A5FF, 0x0000FF}, {0xFFFFFF, 0xFFAD63, 0x843100, 0x000000}}, 
    {0x36, 0, {0x52DE00, 0xFF8400, 0xFFFF00, 0xFFFFFF}, {0xFFFFFF, 0xFFFFFF, 0x63A5FF, 0x0000FF}, {0xFFFFFF, 0xFF8484, 0x943A3A, 0x000000}},
    {0x34, 0, {0xFFFFFF, 0x7BFF00, 0xB57300, 0x000000}, {0xFFFFFF, 0xFF8484, 0x943A3A, 0x000000}, {0xFFFFFF, 0xFF8484, 0x943A3A, 0x000000}},
    {0x66, 'E', {0xFFFFFF, 0x7BFF00, 0xB57300, 0x000000}, {0xFFFFFF, 0xFF8484, 0x943A3A, 0x000000}, {0xFFFFFF, 0xFF8484, 0x943A3A, 0x000000}},
    {0xF4, ' ', {0xFFFFFF, 0x7BFF00, 0xB57300, 0x000000}, {0xFFFFFF, 0xFF8484, 0x943A3A, 0x000000}, {0xFFFFFF, 0xFF8484, 0x943A3A, 0x000000}},
    {0x3D, 0, {0xFFFFFF, 0x52FF00, 0xFF4200, 0x000000}, {0xFFFFFF, 0xFF8484, 0x943A3A, 0x000000}, {0xFFFFFF, 0xFF8484, 0x943A3A, 0x000000}},
    {0x6A, 'I', {0xFFFFFF, 0x52FF00, 0xFF4200, 0x000000}, {0xFFFFFF, 0xFF8484, 0x943A3A, 0x000000}, {0xFFFFFF, 0xFF8484, 0x943A3A, 0x000000}},
    {0x95, 0, {0xFFFFFF, 0x52FF00, 0xFF4200, 0x000000}, {0xFFFFFF, 0x52FF00, 0xFF4200, 0x000000}, {0xFFFFFF, 0x5ABDFF, 0xFF0000, 0x0000FF}},
    {0xB3, 'R', {0xFFFFFF, 0x52FF00, 0xFF4200, 0x000000}, {0xFFFFFF, 0x52FF00, 0xFF4200, 0x000000}, {0xFFFFFF, 0x5ABDFF, 0xFF0000, 0x0000FF}},
    {0x71, 0, {0xFFFFFF, 0xFF9C00, 0xFF0000, 0x000000}, {0xFFFFFF, 0xFF9C00, 0xFF0000, 0x000000}, {0xFFFFFF, 0xFF9C00, 0xFF0000, 0x000000}},
    {0xFF, 0, {0xFFFFFF, 0xFF9C00, 0xFF0000, 0x000000}, {0xFFFFFF, 0xFF9C00, 0xFF0000, 0x000000}, {0xFFFFFF, 0xFF9C00, 0xFF0000, 0x000000}},
    {0x19, 0, {0xFFFFFF, 0xFF9C00, 0xFF0000, 0x000000}, {0xFFFFFF, 0xFF8484, 0x943A3A, 0x000000}, {0xFFFFFF, 0xFF8484, 0x943A3A, 0x000000}},
    {0x3E, 0, {0xFFFFFF, 0xFF9C00, 0xFF0000, 0x000000}, {0xFFFFFF, 0xFF9C00, 0xFF0000, 0x000000}, {0xFFFFFF, 0x5ABDFF, 0xFF0000, 0x0000FF}},
    {0xE0, 0, {0xFFFFFF, 0xFF9C00, 0xFF0000, 0x000000}, {0xFFFFFF, 0xFF9C00, 0xFF0000, 0x000000}, {0xFFFFFF, 0x5ABDFF, 0xFF0000, 0x0000FF}},
    {0x15, 0, {0xFFFFFF, 0xFFFF00, 0xFF0000, 0x000000}, {0xFFFFFF, 0xFFFF00, 0xFF0000, 0x000000}, {0xFFFFFF, 0xFFFF00, 0xFF0000, 0x000000}},
    {0xDB, 0, {0xFFFFFF, 0xFFFF00, 0xFF0000, 0x000000}, {0xFFFFFF, 0xFFFF00, 0xFF0000, 0x000000}, {0xFFFFFF, 0xFFFF00, 0xFF0000, 0x000000}},
    {0x0D, 'R', {0xFFFFFF, 0xFFFF00, 0xFF0000, 0x000000}, {0xFFFFFF, 0xFFFF00, 0xFF0000, 0x000000}, {0xFFFFFF, 0x5ABDFF, 0xFF0000, 0x0000FF}},
    {0x69, 0, {0xFFFFFF, 0xFFFF00, 0xFF0000, 0x000000}, {0xFFFFFF, 0xFFFF00, 0xFF0000, 0x000000}, {0xFFFFFF, 0x5ABDFF, 0xFF0000, 0x0000FF}},
    {0xF2, 0, {0xFFFFFF, 0xFFFF00, 0xFF0000, 0x000000}, {0xFFFFFF, 0xFFFF00, 0xFF0000, 0x000000}, {0xFFFFFF, 0x5ABDFF, 0xFF0000, 0x0000FF}},
    {0x88, 0, {0xA59CFF, 0xFFFF00, 0x006300, 0x000000}, {0xA59CFF, 0xFFFF00, 0x006300, 0x000000}, {0xA59CFF, 0xFFFF00, 0x006300, 0x000000}},
    {0x1D, 0, {0xA59CFF, 0xFFFF00, 0x006300, 0x000000}, {0xFF6352, 0xD60000, 0x630000, 0x000000}, {0xFF6352, 0xD60000, 0x630000, 0x000000}},
    {0x27, 'B', {0xA59CFF, 0xFFFF00, 0x006300, 0x000000}, {0xFF6352, 0xD60000, 0x630000, 0x000000}, {0x0000FF, 0xFFFFFF, 0xFFFF7B, 0x0084FF}},
    {0x49, 0, {0xA59CFF, 0xFFFF00, 0x006300, 0x000000}, {0xFF6352, 0xD60000, 0x630000, 0x000000}, {0x0000FF, 0xFFFFFF, 0xFFFF7B, 0x0084FF}},
    {0x5C, 0, {0xA59CFF, 0xFFFF00, 0x006300, 0x000000}, {0xFF6352, 0xD60000, 0x630000, 0x000000}, {0x0000FF, 0xFFFFFF, 0xFFFF7B, 0x0084FF}},
    {0xB3, 'B', {0xA59CFF, 0xFFFF00, 0x006300, 0x000000}, {0xFF6352, 0xD60000, 0x630000, 0x000000}, {0x0000FF, 0xFFFFFF, 0xFFFF7B, 0x0084FF}},
    {0xC9, 0, {0xFFFFCE, 0x63EFEF, 0x9C8431, 0x5A5A5A}, {0xFFFFFF, 0xFF7300, 0x944200, 0x000000}, {0xFFFFFF, 0x63A5FF, 0x0000FF, 0x000000}},
    {0x46, 'E', {0xB5B5FF, 0xFFFF94, 0xAD5A42, 0x000000}, {0x000000, 0xFFFFFF, 0xFF8484, 0x943A3A}, {0x000000, 0xFFFFFF, 0xFF8484, 0x943A3A}},
    {0x61, 'E', {0xFFFFFF, 0x63A5FF, 0x0000FF, 0x000000}, {0xFFFFFF, 0xFF8484, 0x943A3A, 0x000000}, {0xFFFFFF, 0x63A5FF, 0x0000FF, 0x000000}},
    {0x3C, 0, {0xFFFFFF, 0x63A5FF, 0x0000FF, 0x000000}, {0xFFFFFF, 0x63A5FF, 0x0000FF, 0x000000}, {0xFFFFFF, 0xFF8484, 0x943A3A, 0x000000}},
    {0x4E, 0, {0xFFFFFF, 0x63A5FF, 0x0000FF, 0x000000}, {0xFFFFFF, 0xFF8484, 0x943A3A, 0x000000}, {0xFFFFFF, 0xFFFF7B, 0x0084FF, 0xFF0000}},
    {0x9C, 0, {0xFFFFFF, 0x8C8CDE, 0x52528C, 0x000000}, {0xFFFFFF, 0x8C8CDE, 0x52528C, 0x000000}, {0xFFC542, 0xFFD600, 0x943A00, 0x4A0000}},
    {0x0D, 'E', {0xFFFFFF, 0x8C8CDE, 0x52528C, 0x000000}, {0xFFC542, 0xFFD600, 0x943A00, 0x4A0000}, {0xFFC542, 0xFFD600, 0x943A00, 0x4A0000}},
    {0x18, 'K', {0xFFFFFF, 0x8C8CDE, 0x52528C, 0x000000}, {0xFFC542, 0xFFD600, 0x943A00, 0x4A0000}, {0xFFFFFF, 0x5ABDFF, 0xFF0000, 0x0000FF}},
    {0x6A, 'K', {0xFFFFFF, 0x8C8CDE, 0x52528C, 0x000000}, {0xFFC542, 0xFFD600, 0x943A00, 0x4A0000}, {0xFFFFFF, 0x5ABDFF, 0xFF0000, 0x0000FF}},
    {0x6B, 0, {0xFFFFFF, 0x8C8CDE, 0x52528C, 0x000000}, {0xFFC542, 0xFFD600, 0x943A00, 0x4A0000}, {0xFFFFFF, 0x5ABDFF, 0xFF0000, 0x0000FF}},
    {0xD3, 'R', {0xFFFFFF, 0x8C8CDE, 0x52528C, 0x000000}, {0xFFFFFF, 0xFF8484, 0x943A3A, 0x000000}, {0xFFFFFF, 0x8C8CDE, 0x52528C, 0x000000}},
    {0xBF, ' ', {0xFFFFFF, 0x8C8CDE, 0x52528C, 0x000000}, {0xFFFFFF, 0xFF8484, 0x943A3A, 0x000000}, {0xFFFFFF, 0xFF8484, 0x943A3A, 0x000000}},
    {0x9D, 0, {0xFFFFFF, 0x8C8CDE, 0x52528C, 0x000000}, {0xFFFFFF, 0xFF8484, 0x943A3A, 0x000000}, {0xFFFFFF, 0xFFAD63, 0x843100, 0x000000}},
    {0x28, 'F', {0xFFFFFF, 0x7BFF31, 0x008400, 0x000000}, {0xFFFFFF, 0xFF8484, 0x943A3A, 0x000000}, {0xFFFFFF, 0xFF8484, 0x943A3A, 0x000000}},
    {0x4B, 0, {0xFFFFFF, 0x7BFF31, 0x008400, 0x000000}, {0xFFFFFF, 0xFF8484, 0x943A3A, 0x000000}, {0xFFFFFF, 0xFF8484, 0x943A3A, 0x000000}},
    {0x90, 0, {0xFFFFFF, 0x7BFF31, 0x008400, 0x000000}, {0xFFFFFF, 0xFF8484, 0x943A3A, 0x000000}, {0xFFFFFF, 0xFF8484, 0x943A3A, 0x000000}},
    {0x9A, 0, {0xFFFFFF, 0x7BFF31, 0x008400, 0x000000}, {0xFFFFFF, 0xFF8484, 0x943A3A, 0x000000}, {0xFFFFFF, 0xFF8484, 0x943A3A, 0x000000}},
    {0xBD, 0, {0xFFFFFF, 0x7BFF31, 0x008400, 0x000000}, {0xFFFFFF, 0xFF8484, 0x943A3A, 0x000000}, {0xFFFFFF, 0xFF8484, 0x943A3A, 0x000000}},
    {0x17, 0, {0xFFFFFF, 0x7BFF31, 0x008400, 0x000000}, {0xFFFFFF, 0xFF8484, 0x943A3A, 0x000000}, {0xFFFFFF, 0x63A5FF, 0x0000FF, 0x000000}},
    {0x27, 'N', {0xFFFFFF, 0x7BFF31, 0x008400, 0x000000}, {0xFFFFFF, 0xFF8484, 0x943A3A, 0x000000}, {0xFFFFFF, 0x63A5FF, 0x0000FF, 0x000000}},
    {0x61, 'A', {0xFFFFFF, 0x7BFF31, 0x008400, 0x000000}, {0xFFFFFF, 0xFF8484, 0x943A3A, 0x000000}, {0xFFFFFF, 0x63A5FF, 0x0000FF, 0x000000}},
    {0x8B, 0, {0xFFFFFF, 0x7BFF31, 0x008400, 0x000000}, {0xFFFFFF, 0xFF8484, 0x943A3A, 0x000000}, {0xFFFFFF, 0x63A5FF, 0x0000FF, 0x000000}},
    {0x39, 0, {0xFFFFFF, 0xFFAD63, 0x843100, 0x000000}, {0xFFFFFF, 0x63A5FF, 0x0000FF, 0x000000}, {0xFFFFFF, 0x63A5FF, 0x0000FF, 0x000000}},
    {0x43, 0, {0xFFFFFF, 0xFFAD63, 0x843100, 0x000000}, {0xFFFFFF, 0x63A5FF, 0x0000FF, 0x000000}, {0xFFFFFF, 0x63A5FF, 0x0000FF, 0x000000}},
    {0x97, 0, {0xFFFFFF, 0xFFAD63, 0x843100, 0x000000}, {0xFFFFFF, 0x63A5FF, 0x0000FF, 0x000000}, {0xFFFFFF, 0x63A5FF, 0x0000FF, 0x000000}},
    {0x01, 0, {0xFFFFFF, 0xFFAD63, 0x843100, 0x000000}, {0xFFFFFF, 0x63A5FF, 0x0000FF, 0x000000}, {0xFFFFFF, 0x7BFF31, 0x008400, 0x000000}},
    {0x10, 0, {0xFFFFFF, 0xFFAD63, 0x843100, 0x000000}, {0xFFFFFF, 0x63A5FF, 0x0000FF, 0x000000}, {0xFFFFFF, 0x7BFF31, 0x008400, 0x000000}},
    {0x29, 0, {0xFFFFFF, 0xFFAD63, 0x843100, 0x000000}, {0xFFFFFF, 0x63A5FF, 0x0000FF, 0x000000}, {0xFFFFFF, 0x7BFF31, 0x008400, 0x000000}},
    {0x52, 0, {0xFFFFFF, 0xFFAD63, 0x843100, 0x000000}, {0xFFFFFF, 0x63A5FF, 0x0000FF, 0x000000}, {0xFFFFFF, 0x7BFF31, 0x008400, 0x000000}},
    {0x5D, 0, {0xFFFFFF, 0xFFAD63, 0x843100, 0x000000}, {0xFFFFFF, 0x63A5FF, 0x0000FF, 0x000000}, {0xFFFFFF, 0x7BFF31, 0x008400, 0x000000}},
    {0x68, 0, {0xFFFFFF, 0xFFAD63, 0x843100, 0x000000}, {0xFFFFFF, 0x63A5FF, 0x0000FF, 0x000000}, {0xFFFFFF, 0x7BFF31, 0x008400, 0x000000}},
    {0x6D, 0, {0xFFFFFF, 0xFFAD63, 0x843100, 0x000000}, {0xFFFFFF, 0x63A5FF, 0x0000FF, 0x000000}, {0xFFFFFF, 0x7BFF31, 0x008400, 0x000000}},
    {0xF6, 0, {0xFFFFFF, 0xFFAD63, 0x843100, 0x000000}, {0xFFFFFF, 0x63A5FF, 0x0000FF, 0x000000}, {0xFFFFFF, 0x7BFF31, 0x008400, 0x000000}},
    {0x14, 0, {0xFFFFFF, 0xFF8484, 0x943A3A, 0x000000}, {0xFFFFFF, 0x7BFF31, 0x008400, 0x000000}, {0xFFFFFF, 0xFF8484, 0x943A3A, 0x000000}},
    {0x70, 0, {0xFFFFFF, 0xFF8484, 0x943A3A, 0x000000}, {0xFFFFFF, 0x00FF00, 0x318400, 0x004A00}, {0xFFFFFF, 0x63A5FF, 0x0000FF, 0x000000}},
    {0x0C, 0, {0xFFFFFF, 0xFFAD63, 0x843100, 0x000000}, {0xFFFFFF, 0xFFAD63, 0x843100, 0x000000}, {0xFFFFFF, 0xFFAD63, 0x843100, 0x000000}},
    {0x16, 0, {0xFFFFFF, 0xFFAD63, 0x843100, 0x000000}, {0xFFFFFF, 0xFFAD63, 0x843100, 0x000000}, {0xFFFFFF, 0xFFAD63, 0x843100, 0x000000}},
    {0x35, 0, {0xFFFFFF, 0xFFAD63, 0x843100, 0x000000}, {0xFFFFFF, 0xFFAD63, 0x843100, 0x000000}, {0xFFFFFF, 0xFFAD63, 0x843100, 0x000000}},
    {0x67, 0, {0xFFFFFF, 0xFFAD63, 0x843100, 0x000000}, {0xFFFFFF, 0xFFAD63, 0x843100, 0x000000}, {0xFFFFFF, 0xFFAD63, 0x843100, 0x000000}},
    {0x75, 0, {0xFFFFFF, 0xFFAD63, 0x843100, 0x000000}, {0xFFFFFF, 0xFFAD63, 0x843100, 0x000000}, {0xFFFFFF, 0xFFAD63, 0x843100, 0x000000}},
    {0x92, 0, {0xFFFFFF, 0xFFAD63, 0x843100, 0x000000}, {0xFFFFFF, 0xFFAD63, 0x843100, 0x000000}, {0xFFFFFF, 0xFFAD63, 0x843100, 0x000000}},
    {0x99, 0, {0xFFFFFF, 0xFFAD63, 0x843100, 0x000000}, {0xFFFFFF, 0xFFAD63, 0x843100, 0x000000}, {0xFFFFFF, 0xFFAD63, 0x843100, 0x000000}},
    {0xB7, 0, {0xFFFFFF, 0xFFAD63, 0x843100, 0x000000}, {0xFFFFFF, 0xFFAD63, 0x843100, 0x000000}, {0xFFFFFF, 0xFFAD63, 0x843100, 0x000000}},
    {0xA5, 'R', {0xFFFFFF, 0xFFAD63, 0x843100, 0x000000}, {0xFFFFFF, 0x7BFF31, 0x008400, 0x000000}, {0xFFFFFF, 0x7BFF31, 0x008400, 0x000000}},
    {0xA2, 0, {0xFFFFFF, 0xFFAD63, 0x843100, 0x000000}, {0xFFFFFF, 0x7BFF31, 0x008400, 0x000000}, {0xFFFFFF, 0x63A5FF, 0x0000FF, 0x000000}},
    {0xF7, 0, {0xFFFFFF, 0xFFAD63, 0x843100, 0x000000}, {0xFFFFFF, 0x7BFF31, 0x008400, 0x000000}, {0xFFFFFF, 0x63A5FF, 0x0000FF, 0x000000}},
    {0x28, 'A', {0x000000, 0x008484, 0xFFDE00, 0xFFFFFF}, {0x000000, 0x008484, 0xFFDE00, 0xFFFFFF}, {0x000000, 0x008484, 0xFFDE00, 0xFFFFFF}},
    {0xA5, 'A', {0x000000, 0x008484, 0xFFDE00, 0xFFFFFF}, {0x000000, 0x008484, 0xFFDE00, 0xFFFFFF}, {0x000000, 0x008484, 0xFFDE00, 0xFFFFFF}},
    {0xE8, 0, {0x000000, 0x008484, 0xFFDE00, 0xFFFFFF}, {0x000000, 0x008484, 0xFFDE00, 0xFFFFFF}, {0x000000, 0x008484, 0xFFDE00, 0xFFFFFF}},
    {0x46, 'R', {0xFFFFFF, 0x63A5FF, 0x0000FF, 0x000000}, {0xFFFF00, 0xFF0000, 0x630000, 0x000000}, {0xFFFFFF, 0x7BFF31, 0x008400, 0x000000}},
    {0xD3, 'I', {0xFFFFFF, 0xADAD84, 0x42737B, 0x000000}, {0xFFFFFF, 0xFFAD63, 0x843100, 0x000000}, {0xFFFFFF, 0x63A5FF, 0x0000FF, 0x000000}},
    {0x58, 0, {0xFFFFFF, 0xA5A5A5, 0x525252, 0x000000}, {0xFFFFFF, 0xA5A5A5, 0x525252, 0x000000}, {0xFFFFFF, 0xA5A5A5, 0x525252, 0x000000}},
    {0x6F, 0,  {0xFFFFFF, 0xFFCE00, 0x9C6300, 0x000000}, {0xFFFFFF, 0xFFCE00, 0x9C6300, 0x000000}, {0xFFFFFF, 0xFFCE00, 0x9C6300, 0x000000}},
    {0xAA, 0, {0xFFFFFF, 0x7BFF31, 0x0063C5, 0x000000}, {0xFFFFFF, 0xFF8484, 0x943A3A, 0x000000}, {0xFFFFFF, 0x7BFF31, 0x0063C5, 0x000000}},
    {0x18, 'I', {0xFFFFFF, 0x7BFF31, 0x0063C5, 0x000000}, {0xFFFFFF, 0xFF8484, 0x943A3A, 0x000000}, {0xFFFFFF, 0xFF8484, 0x943A3A, 0x000000}},
    {0x3F, 0, {0xFFFFFF, 0x7BFF31, 0x0063C5, 0x000000}, {0xFFFFFF, 0xFF8484, 0x943A3A, 0x000000}, {0xFFFFFF, 0xFF8484, 0x943A3A, 0x000000}},
    {0x66, 'L', {0xFFFFFF, 0x7BFF31, 0x0063C5, 0x000000}, {0xFFFFFF, 0xFF8484, 0x943A3A, 0x000000}, {0xFFFFFF, 0xFF8484, 0x943A3A, 0x000000}},
    {0xC6, ' ', {0xFFFFFF, 0x7BFF31, 0x0063C5, 0x000000}, {0xFFFFFF, 0xFF8484, 0x943A3A, 0x000000}, {0xFFFFFF, 0xFF8484, 0x943A3A, 0x000000}},
    {0xF4, '-', {0xFFFFFF, 0x7BFF31, 0x0063C5, 0x000000}, {0xFFFFFF, 0xFF8484, 0x943A3A, 0x000000}, {0xFFFFFF, 0x63A5FF, 0x0000FF, 0x000000}}
};

static u8 getCgbTitleHash(const char* rom_name);

void gb_skipDmgBootrom(gb_t* gb){
    sm83_t* cpu = &gb->cpu;
    cpu->AF = 0x01B0;
    cpu->BC = 0x0013;
    cpu->DE = 0x00D8;
    cpu->HL = 0x014D;
    cpu->SP = 0xFFFE;
    cpu->PC = 0x0100;
    
    cpu->Z_FLAG = true;
    cpu->N_FLAG = false;
    cpu->H_FLAG = true;
    cpu->C_FLAG = true;

    cpu->HALTED = false;
    cpu->IME = false;
    cpu->EI_DELAY = false;
    
    serial_t* serial = &gb->serial;
    serial->SB_REG = 0x00;
    serial->SC_REG = 0x7E;
    gb_timer_t* tmr = &gb->timer;
    tmr->div = 0xAB;
    tmr->TIMA_REG = 0x00;
    tmr->TMA_REG = 0x00;
    tmr->TAC_REG = 0xF8;
    cpu->IF = 0xE1;
    apu_t* apu = &gb->apu;
    apu->NR10_REG = 0x80;
    apu->NR11_REG = 0xBF;
    apu->NR12_REG = 0xF3;
    apu->NR13_REG = 0xFF;
    apu->NR14_REG = 0xBF;
    apu->NR21_REG = 0x3F;
    apu->NR22_REG = 0x00;
    apu->NR23_REG = 0xFF;
    apu->NR24_REG = 0xBF;
    apu->NR30_REG = 0x7F;
    apu->NR31_REG = 0xFF;
    apu->NR32_REG = 0x9F;
    apu->NR33_REG = 0xFF;
    apu->NR34_REG = 0xBF;
    apu->NR41_REG = 0xFF;
    apu->NR42_REG = 0x00;
    apu->NR43_REG = 0x00;
    apu->NR44_REG = 0xBF;
    apu->NR50_REG = 0x77;
    apu->NR51_REG = 0xF3;
    apu->NR52_REG = 0xF1;
    ppu_t* ppu = &gb->ppu;
    ppu->LCDC_REG = 0x91;
    ppu->STAT_REG = 0x85;
    ppu->SCY_REG	= 0x00;
    ppu->SCX_REG	= 0x00;
    ppu->LY_REG	= 0x00;
    ppu->LYC_REG	= 0x00;
    ppu->BGP_REG = 0xFC;
    ppu->OBP0_REG = 0x00;
    ppu->OBP1_REG = 0x00;
    ppu->WY_REG = 0x00;
    ppu->WX_REG = 0x00;
    dma_t* dma = &gb->dma;
    dma->DMA_REG = 0xFF;
    cpu->IE = 0x00;
}

void gb_skipCgbBootrom(gb_t* gb){
    sm83_t* cpu = &gb->cpu;
    cpu->A = 0x11;
    cpu->BC = 0x0000;
    cpu->DE = 0x0008;
    cpu->HL = 0x0000;
    cpu->SP = 0xFFFE;
    cpu->PC = 0x0100;
    
    cpu->Z_FLAG = true;
    cpu->N_FLAG = false;
    cpu->H_FLAG = false;
    cpu->C_FLAG = false;

    cpu->HALTED = false;
    cpu->IME = false;
    cpu->EI_DELAY = false;

    gb->joypad.JOYP_REG = 0xC7;
    serial_t* serial = &gb->serial;
    serial->SB_REG = 0x00;
    serial->SC_REG = 0x7E;
    gb_timer_t* tmr = &gb->timer;
    tmr->div = 0x00;
    tmr->TIMA_REG = 0x00;
    tmr->TMA_REG = 0x00;
    tmr->TAC_REG = 0xF8;
    cpu->IF = 0xE1;
    apu_t* apu = &gb->apu;
    apu->NR10_REG = 0x80;
    apu->NR11_REG = 0xBF;
    apu->NR12_REG = 0xF3;
    apu->NR13_REG = 0xFF;
    apu->NR14_REG = 0xBF;
    apu->NR21_REG = 0x3F;
    apu->NR22_REG = 0x00;
    apu->NR23_REG = 0xFF;
    apu->NR24_REG = 0xBF;
    apu->NR30_REG = 0x7F;
    apu->NR31_REG = 0xFF;
    apu->NR32_REG = 0x9F;
    apu->NR33_REG = 0xFF;
    apu->NR34_REG = 0xBF;
    apu->NR41_REG = 0xFF;
    apu->NR42_REG = 0x00;
    apu->NR43_REG = 0x00;
    apu->NR44_REG = 0xBF;
    apu->NR50_REG = 0x77;
    apu->NR51_REG = 0xF3;
    apu->NR52_REG = 0xF0;
    ppu_t* ppu = &gb->ppu;
    ppu->LCDC_REG = 0x91;
    ppu->STAT_REG = 0x00;
    ppu->SCY_REG = 0x00;
    ppu->SCX_REG = 0x00;
    ppu->LY_REG = 0x00;
    ppu->LYC_REG = 0x00;
    ppu->BGP_REG = 0xFC;
    ppu->OBP0_REG = 0x00;
    ppu->OBP1_REG = 0x00;
    ppu->WY_REG = 0x00;
    ppu->WX_REG = 0x00;
    ppu->BCPS_REG = 0x00;
    ppu->OCPS_REG = 0x00;
    gb->KEY1_REG = 0x7E;
    gb->VBK_REG = 0x00;
    dma_t* dma = &gb->dma;
    dma->DMA_REG = 0xFF;
    dma->HDMA_REGS[0] = 0xFF;
    dma->HDMA_REGS[1] = 0xFF;
    dma->HDMA_REGS[2] = 0xFF;
    dma->HDMA_REGS[3] = 0xFF;
    dma->HDMA_REGS[4] = 0xFF;
    gb->SVBK_REG = 0x00;
    cpu->IE = 0x00;

    if(gb->ROM[0x143] < 0x80){
        gb_hleDmgColorization(gb);
        gb->console_type = DMG_ON_CGB_TYPE;
    } else {
        gb_copyDefaultCgbPalette(gb);
    }
}

u8 getCgbTitleHash(const char* rom_name){
    u8 hash = 0;
    while(*rom_name){
        hash += *rom_name;
        rom_name++;
    }
    return hash;
}

void gb_hleDmgColorization(gb_t* gb){
    u8* rom = gb->ROM;
    const char* rom_name = gb_getRomName(rom);
    u8 hash = getCgbTitleHash(rom_name);
    char forth_char = rom_name[3];
    const char* manufact_name = gb_getManufacturerName(rom);

    if(!strcmp(manufact_name, "Nintendo") || !strcmp(manufact_name, "Nintendo R&D1"))
        for(int i = 0; i < sizeof(paletteConfigs)/sizeof(paletteConfig); i++){
            paletteConfig* config = &paletteConfigs[i];
            if(config->hash == hash && (config->forth_char == forth_char || !config->forth_char)){
                for(int j = 0; j < 4; j++){
                    int bg_col = config->bg[j];
                    int obj0_col = config->obj0[j];
                    int obj1_col = config->obj1[j];

                    gb_writeColorToCRAM((bg_col >> 16) & 0xFF, (bg_col >> 8) & 0xFF, bg_col & 0xFF, gb->BGP_CRAM, j);
                    gb_writeColorToCRAM((obj0_col >> 16) & 0xFF, (obj0_col >> 8) & 0xFF, obj0_col & 0xFF, gb->OBP_CRAM, j);
                    gb_writeColorToCRAM((obj1_col >> 16) & 0xFF, (obj1_col >> 8) & 0xFF, obj1_col & 0xFF, gb->OBP_CRAM , j + 4);
                }
                return;
            }
        }

    // standard colors for unknown games
    for(int j = 0; j < 4; j++){
        int bg_col = paletteConfigs[0].bg[j];
        int obj0_col = paletteConfigs[0].obj0[j];
        int obj1_col = paletteConfigs[0].obj1[j];

        gb_writeColorToCRAM((bg_col >> 16) & 0xFF, (bg_col >> 8) & 0xFF, bg_col & 0xFF, gb->BGP_CRAM, j);
        gb_writeColorToCRAM((obj0_col >> 16) & 0xFF, (obj0_col >> 8) & 0xFF, obj0_col & 0xFF, gb->OBP_CRAM, j);
        gb_writeColorToCRAM((obj1_col >> 16) & 0xFF, (obj1_col >> 8) & 0xFF, obj1_col & 0xFF, gb->OBP_CRAM, j + 4);
    }
}

#ifdef __EMSCRIPTEN__
extern gb_t gb;
void switchCompatibilityMode(){
    if(gb.console_type == DMG_TYPE){
        gb.console_type = DMG_ON_CGB_TYPE;
        hleDmgColorization(&gb);
    } else if(gb.console_type == DMG_ON_CGB_TYPE){
        gb.console_type = DMG_TYPE;
    }

    initColorPalette(&gb);
}
#endif